////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

using AndroidPlusPlus.MsBuild.Common;
using AndroidPlusPlus.MsBuild.Common.Attributes;
using Microsoft.Build.Framework;
using System.Reflection;
using System.Resources;

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

namespace AndroidPlusPlus.MsBuild.MSBuild.DeployTasks
{

  public class AndroidZipAlign : TrackedToolTask
  {

    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

    public AndroidZipAlign ()
      : base (new ResourceManager ("AndroidPlusPlus.MsBuild.DeployTasks.Properties.Resources", Assembly.GetExecutingAssembly ()))
    {
    }

    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

    [SwitchBool(Switch = "-c", Description = "check alignment only (does not modify file)")]
    public bool Check { get; set; }

    [SwitchBool(Switch = "-f", Description = "overwrite existing outfile.zip")]
    public bool Overwrite { get; set; }

    [SwitchBool(Switch = "-p", Description = "memory page alignment for stored shared object files")]
    public bool MemoryPageAlignment { get; set; }

    [SwitchBool(Switch = "-v", Description = "verbose output")]
    public bool Verbose { get; set; }

    [SwitchBool(Switch = "-z", Description = "recompress using Zopfli")]
    public bool RecompressUsingZopfli { get; set; }

    [Required]
    [SwitchInt(IsRequired = true, Description = "alignment in bytes, e.g. '4' provides 32-bit alignment")]
    public int Alignment { get; set; }

    [Required]
    [SwitchString(IsRequired = true, Subtype = "file")]
    public ITaskItem InFile { get; set; }

    [SwitchString(Subtype = "file")]
    public ITaskItem Outfile { get; set; }

    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

    protected override bool ValidateParameters()
    {
      InputFiles = new ITaskItem[] { InFile };

      return base.ValidateParameters();
    }

    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

    protected override string GenerateResponseFileCommands()
    {
      return string.Empty; // zipalign doesn't support response files.
    }

    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

  }

}
