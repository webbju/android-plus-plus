////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

using AndroidPlusPlus.MsBuild.Common;
using AndroidPlusPlus.MsBuild.Common.Attributes;
using Microsoft.Build.Framework;
using System.Reflection;
using System.Resources;

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

namespace AndroidPlusPlus.MsBuild.MSBuild.DeployTasks
{

  ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

  public class JavaSigner : TrackedOutOfDateToolTask
  {
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

    public JavaSigner ()
      : base (new ResourceManager ("AndroidPlusPlus.MsBuild.DeployTasks.Properties.Resources", Assembly.GetExecutingAssembly ()))
    {
    }

    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

    [Required]
    [SwitchString(IsRequired = true, Subtype = "file", Switch = "-keystore", Separator = " ")]
    public ITaskItem Keystore { get; set; }

    [Required]
    [SwitchString(IsRequired = true, Switch = "-storepass", Separator = " ")]
    public string KeystorePass { get; set; }

    [SwitchString(Switch = "-storetype", Separator = " ")]
    public string KeystoreType { get; set; }

    [SwitchString(Switch = "-keypass", Separator = " ")]
    public string PrivateKeyPassword { get; set; }

    [SwitchString(Switch = "-sigfile", Separator = " ")]
    public string SignatureFile { get; set; }

    [SwitchString(Switch = "-digestalg", Separator = " ")]
    public string DigestAlgorithm { get; set; } = "SHA1";

    [SwitchString(Switch = "-sigalg", Separator = " ")]
    public string SignatureAlgorithm { get; set; }

    [SwitchBool(Switch = "-verbose", Separator = " ")]
    public bool Verbose { get; set; }

    [SwitchBool(Switch = "-certs", Separator = " ")]
    public bool DisplayCertificates { get; set; }

    [SwitchBool(Switch = "-protected", Separator = " ")]
    public bool Protected { get; set; }

    [Required]
    [SwitchString(Subtype = "file")]
    public ITaskItem UnsignedJar { get; set; }

    [SwitchString(IsRequired = true)]
    public string KeystoreAlias { get; set; }

    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

    protected override bool ValidateParameters()
    {
      InputFiles = new ITaskItem[] { Keystore, UnsignedJar };

      return base.ValidateParameters();
    }

    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

    protected override string GenerateResponseFileCommands()
    {
      return string.Empty; // jarsigner does not support response files.
    }

    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

    protected override void LogEventsFromTextOutput(string singleLine, MessageImportance messageImportance)
    {
      base.LogEventsFromTextOutput(JavaUtilities.ConvertJavaOutputToVS(singleLine), messageImportance);
    }

    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

  }

  ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
