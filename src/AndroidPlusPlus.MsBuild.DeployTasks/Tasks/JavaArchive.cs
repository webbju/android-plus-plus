////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

using AndroidPlusPlus.MsBuild.Common;
using AndroidPlusPlus.MsBuild.Common.Attributes;
using Microsoft.Build.Framework;
using System.Collections.Generic;
using System.Reflection;
using System.Resources;

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

namespace AndroidPlusPlus.MsBuild.DeployTasks
{

  public class JavaArchive : TrackedToolTask
  {

    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

    public JavaArchive ()
      : base (new ResourceManager ("AndroidPlusPlus.MsBuild.DeployTasks.Properties.Resources", Assembly.GetExecutingAssembly ()))
    {
    }

    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

    [Required]
    [SwitchEnum(IsRequired = true)]
    [SwitchEnumValue(Name = "Create", Switch = "-c")]
    [SwitchEnumValue(Name = "GenerateIndex", Switch = "-i")]
    [SwitchEnumValue(Name = "List", Switch = "-t")]
    [SwitchEnumValue(Name = "Update", Switch = "-u")]
    [SwitchEnumValue(Name = "Extract", Switch = "-x")]
    [SwitchEnumValue(Name = "Describe", Switch = "-d")]
    public string Mode { get; set; } = "Create";

    [SwitchBool(Switch = "-0", Description = "Stores without using ZIP compression.")]
    public bool NoCompress { get; set; }

    [Required]
    [SwitchString(IsRequired = true, Subtype = "file", Switch = "--file", Separator = "=")]
    public ITaskItem OutputJar { get; set; }

    [SwitchString(Subtype = "file", Switch = "--manifest", Separator = "=")]
    public ITaskItem ManifestFile { get; set; }

    [SwitchString(Subtype = "folder", Switch = "-C")]
    public ITaskItem ChangeDirectory { get; set; }

    [Required]
    [SwitchStringList(Subtype = "file")]
    public ITaskItem[] ClassFiles { get; set; }

    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

    protected override bool ValidateParameters()
    {
      var inputFiles = new List<ITaskItem>();

      if (ManifestFile != null)
      {
        inputFiles.Add(ManifestFile);
      }

      inputFiles.AddRange(ClassFiles);

      InputFiles = inputFiles.ToArray();

      return base.ValidateParameters();
    }

    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

  }

}
