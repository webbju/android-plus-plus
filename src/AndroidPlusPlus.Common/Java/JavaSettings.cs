////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

using Microsoft.Win32;
using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

namespace AndroidPlusPlus.Common
{

  public class JavaSettings
  {

    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

    private static string _jdkRoot;

    public static string JdkRoot
    {
      get
      {
        if (_jdkRoot == null)
        {
          var jdkPossibleLocations = new HashSet<string>(2);

          jdkPossibleLocations.Add(Environment.ExpandEnvironmentVariables("%JAVA_HOME%"));

          try
          {
            using RegistryKey localMachineJavaDevelopmentKit = Registry.LocalMachine.OpenSubKey(@"SOFTWARE\JavaSoft\Java Development Kit\");

            string currentVersion = localMachineJavaDevelopmentKit?.GetValue("CurrentVersion") as string;

            if (!string.IsNullOrEmpty(currentVersion))
            {
              using RegistryKey localMachineJdkCurrentVersion = localMachineJavaDevelopmentKit.OpenSubKey(currentVersion);

              jdkPossibleLocations.Add(localMachineJdkCurrentVersion?.GetValue("JavaHome") as string);
            }
          }
          catch (Exception e)
          {
            LoggingUtils.HandleException(e);
          }

          jdkPossibleLocations.RemoveWhere(path => !File.Exists(Path.Combine(path, "bin", "java.exe")));

          _jdkRoot = jdkPossibleLocations.First();
        }

        return _jdkRoot;
      }
      set => _jdkRoot = value;
    }

    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

  }

}
